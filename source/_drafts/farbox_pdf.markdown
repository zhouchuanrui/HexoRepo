title: Farbox Editor的pdf导出
Status: Public
Tags: pdf
date: 2013-8-28 11:16:08
---

[TOC]

# CH1

一直一来我是非常需要这样一种生成pdf文档的工具：能用通用编辑器快速编辑，带有大纲、列表、表格、公式、链接索引，方便的插图，简单的排版格式。

所以Farbox Editor对我最大的吸引力就是pdf导出了，Farbox的markdown支持github风格的代码高亮排版，这个是个意外之喜。下载完Farbox Editor之后看帮助说到还支持文件夹里面的全部导出，直接让我心花怒放了。看起来Farbox Editor跟我所期望的只差一个公式了，非常不错。

<!--more-->

# CH2
## 问题显现

但是情况没这么顺利，一边用Farbox Editor的时候，我就发现越来越多的状况。

首先是本地预览的状态跟PDF里面的差别比较大，而且有一个比较明显的bug，就是列表项的第三个项的缩进跟其他的项都不一样，可以一眼看出。

然后是脚注的问题，脚注是Farbox的另外一个markdown私货。脚注我之前是基本都没用过，但是在Farbox里面一用就觉得很好用，我想这个才是真正的好东西啊，在网页里面表现很好，可以交叉跳转。哪知道pdf导出的时候竟然会出错，说的是脚注的引用错误。搞的我有点失落。

其实这些还是小问题，列表的话忍忍就好，脚注的话反正之前也基本没用的。

## 悲剧CSS

Farbox的特点是简洁，但是再简洁还是要有基本的样式；另一个特点是可以自定义样式，就是说你至少要会改CSS。

之前说Farbox的网页表现不错，但是不久之后，还是渐渐有几个方面让人不爽的：

- 我之前的习惯是在段首放两个全角空格当作缩进，这个在简书里面是识别的，然而在Farbox里面竟然不识别。这个其实没什么的，主要是是Farbox的markdown里面隔一个空白行才算分段，不然是用`<br>`分小段，然后`<br>`之后的小段却识别，所以我之前的一些文档显示起来就是第一小段无缩进，然后后面的小段都是有两个全角空格的缩进。后面我只能改源文档了，把所有的全角空格都去掉，然后每段之间都加空行。
- 默认的英文字体是一个等宽字字体，我是觉得代码里面才应该用等宽字的。
- 列表没有缩进，看过去跟普通文本不像是markdown里面有语法区别的元素。
- 代码块的字体大小比较合适，就是行距太大了，要放大段代码的话估计不大行。

积累了这么几点之后，改CSS的意愿已经比较强烈了。

Farbox Editor的工作目录下有默认样式的CSS文件，一看之下靠我三脚猫功夫似乎还是下的去手的。虽然这个文件只是本地预览的效果，但是pdf文件也必定是这个样式文件决定的， **不过pdf的样式才是主要目的** ，然后我就操起编辑器和浏览器这种徒手杀猪工具开始行动了。

网页样式改起来还是蛮顺利的，虽然花了不少的时间，改动的地方主要有：

- 英文字体改成"Candara"，数字3有着漂亮的小下沉效果；
- 文章标题居中；
- 大纲标题的字体大小调整；
- 行距调整，调小了行距，看过去紧凑了点，代码段的调的更小，看过去跟编辑器的效果相当；
- 段落调整，包括：
	- 首行缩进2em，两个全角空格缩进出来了；
	- 段间距离调为零，就是跟行距一样；
- 颜色的微调，其他的跟原来的基本没区别，链接颜色换成我钟爱的鸡屎绿；
- 列表缩进调整，跟段落一样的调整；
- 列表块的上下间隔调整，看上去终于像是独立的块了；
- 引用段里面去掉缩进；
- 表格居中；

不管怎么说，改过之后感觉好多了。但是，一用到pdf导出，出了好多问题。先是一直出错，在CSS里面找了半天结果发现是里面有个分号没写。但是网页里面没出问题啊，看来网页转换跟独家的pdf转换的健壮性毕竟还是不一样。然后就是，导出后里面出来的东西真是不能直视。其实主要是列表，那个列表间隔是有小半页，然后图片的外框错位了，仔细点看的话小代码段的背景也错位了。真是悲剧。我以为是软件出问题了，把代码恢复，结果是正常的。

没办法，pdf的样式这样网页再好也不能用啊。只好逐条的修改然后看看pdf输出了。这怎么说呢，其实当时已经比较忐忑了，感觉这个水还是不浅。找了半天，找到列表的项，发现是`padding`和`margin`属性的问题，就是新改的文件里面把原来的一段：
```css
ul, ol {
	line-height: 2.1;
}

ol {
	margin: 0;
}

ul{
	padding: 5px 38px;
	margin: 0;
}

ul li, li{
	padding: 0;
	margin: 0;
	line-height: 2.1em;
}

ul p, ol p{
	overflow: visible;
}
```
里面的这两个属性都注释掉了，然后pdf里面这两个属性的默认值应该是个比较大的值，然后就悲剧了。

解决了这个之后，也算练了个级，后面的一些小问题也就很快解决了。

后面又弄了很久，虽然最早的问题还是存在，然后又发现了其他的一些小毛病，不过总算还是可以见人了，调出的样式还是跟CSS里面靠拢的。

# CH3

好事多磨，经过这个事情，感觉对markdown的理解又深了一层。

当下markdown是蛮热门的，很多网站都相继推出。但是markdown毕竟算是html的子集，markdown虽然有标准，但是基本最基本的标准表现力实在不行，跟org-mode比起来还差很多。所以基本每个网站都会有自己的私货，CSS就更是让人眼花缭乱了。所以导出为pdf的时候，要是纯html还好，加了CSS这个难度就不是一个数量级的了。

据说markdown要出新的标准，可能到时候情况会好点，然后markdown直接转pdf的标准才指望的上。原本用Farbox Editor是想做个小型文档生成器的，目前看来不能省心啊。


